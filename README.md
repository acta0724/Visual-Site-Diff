# Visual Site Diff - 画像差分検出システム

コンピュータビジョン技術を活用した高精度な画像差分検出・物体検知システム

## 概要

このシステムは2枚の画像を比較し、変化した領域を自動検出・可視化するWebアプリケーションです。建設現場の進捗管理、設備点検、品質管理など様々な用途に活用できます。

## 主な機能

### 🔍 画像差分検出
- SIFT/ORB/AKAZE特徴点を用いた高精度な位置合わせ
- RANSACアルゴリズムによる頑健なホモグラフィ推定
- 適応的閾値処理による差分領域抽出

### 🎯 物体検知
- 変化領域の自動グループ化
- バウンディングボックスによる物体位置特定
- IoU（Intersection over Union）による重複領域統合

### 📊 結果出力
- 統計情報（特徴点数、類似度スコア等）
- 複数形式での結果可視化
- JSON/CSV/ZIPでのエクスポート機能

## 技術スタック

### 画像処理
- **OpenCV**: 画像処理、特徴点検出、変換処理
- **NumPy**: 数値計算、配列操作
- **PIL/Pillow**: 画像ファイル操作

### Webアプリケーション
- **Flask**: バックエンドフレームワーク
- **HTML/CSS/JavaScript**: フロントエンド
- **Bootstrap**: レスポンシブUI

### 主要アルゴリズム
- **SIFT**: Scale-Invariant Feature Transform
- **RANSAC**: Random Sample Consensus
- **CLAHE**: Contrast Limited Adaptive Histogram Equalization
- **モルフォロジー演算**: ノイズ除去・領域統合

## セットアップ

### 1. 仮想環境の作成・アクティベート
```bash
cd Visual-Site-Diff
python -m venv myenv
source myenv/bin/activate  # macOS/Linux
# myenv\Scripts\activate   # Windows
```

### 2. 依存関係のインストール
```bash
pip install -r requirement.txt
```

### 3. アプリケーション起動
```bash
cd application
python app.py
```

### 4. ブラウザアクセス
```
http://localhost:5001
```

## 使用方法

### 基本操作
1. **画像選択**: 基準画像と比較画像をアップロード（デフォルトでサンプル画像設定済み）
2. **パラメータ調整**: 詳細設定タブで各種パラメータを調整
3. **実行**: 「実行」ボタンをクリックして解析開始
4. **結果確認**: 差分画像、物体検知結果等を確認

### パラメータ設定
- **特徴量抽出手法**: SIFT（高精度）/ ORB（高速）/ AKAZE（バランス）
- **マッチング閾値**: 特徴点マッチングの厳密さ（0.0-1.0）
- **差分感度**: 差分検出の感度（0-255）
- **最小面積**: 検出対象の最小領域サイズ
- **カーネルサイズ**: モルフォロジー演算のカーネルサイズ

## 出力結果

### 画像出力
- **基準画像**: 元の基準画像
- **比較画像**: 元の比較画像  
- **差分画像**: 白黒での差分表示
- **位置調整後**: ホモグラフィ変換後の画像
- **差分ハイライト**: 差分領域を赤色で塗りつぶし表示
- **物体検知**: バウンディングボックスによる物体位置表示

### 統計情報
- 特徴点数（基準画像・比較画像）
- マッチした特徴点数
- 類似度スコア
- 有効マッチ数
- 検出された差分領域数
- 検出された変化物体数

## プロジェクト構成

```
Visual-Site-Diff/
├── application/
│   ├── app.py              # Flaskアプリケーション
│   ├── main.py             # 画像処理コアロジック
│   ├── templates/
│   │   └── index.html      # Webインターface
│   ├── static/             # デフォルト画像
│   ├── uploads/            # アップロード画像（自動生成）
│   └── results/            # 処理結果（自動生成）
├── myenv/                  # Python仮想環境
├── floor/                  # サンプル画像
└── README.md
```

## 画像処理手法の選択理由

### 前処理
- **グレースケール変換**: 計算量削減と頑健な特徴抽出
- **ガウシアンブラー**: ノイズ抑制と本質的差分の検出
- **CLAHE**: 照明条件差への対応

### 特徴点検出
- **SIFT/ORB/AKAZE**: 撮影条件変化に対する頑健性
- **RANSAC**: 外れ値に対する頑健な変換推定

### 差分検出
- **適応的処理**: 照明変化に影響されない検出
- **モルフォロジー処理**: 実用的な検出精度の確保

## 応用例

- **建設現場**: 工事進捗の自動監視
- **設備点検**: 機器状態の変化検出
- **品質管理**: 製品の外観検査
- **セキュリティ**: 監視エリアの異常検出
- **研究用途**: 実験結果の定量的比較

## 注意事項

- 最適な結果を得るには、同一視点からの撮影を推奨
- 照明条件の大幅な変化は検出精度に影響する可能性
- 処理時間は画像サイズと選択した特徴抽出手法に依存
- セッション管理により古いファイルは自動削除（最新5個を保持）

